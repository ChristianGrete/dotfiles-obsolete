#!/bin/sh

cd "$(dirname "$0")/.."

if [ -z ${HOME:+_} ]
  then
    echo "$HOME: home directory not found"
    exit 1
fi

. "${PWD:=$(pwd)}/bin/setup"

export BINARIES="$PWD/bin"

source "$BINARIES/build"

printf 'Please enter a version number: '
read VERSION

for tag in $(git tag -l)
  do
    if [ "$tag" = "$VERSION" ]
      then
        echo "$VERSION: tag already exists"
        exit 1
    fi
done

git add dist
git commit -m "release(v$VERSION): distribute [ci skip]"
git push origin master

git tag -a "$VERSION" -m "v$VERSION"
git push origin --tags
